@inject SupabaseService Supabase
@inject IJSRuntime JS

@if (BottomBar)
{
    <!-- Bottom tab bar for mobile -->
    <div class="tab-bar">
        <AuthorizeView>
            <Authorized>
                <NavLink class="tab-item" href="" Match="NavLinkMatch.All">
                    <span class="tab-icon">ğŸ </span>
                    <span class="tab-label">Home</span>
                </NavLink>
                <NavLink class="tab-item" href="shopping-list">
                    <span class="tab-icon">ğŸ›’</span>
                    <span class="tab-label">Shop</span>
                </NavLink>
                <NavLink class="tab-item" href="recipes">
                    <span class="tab-icon">ğŸ“–</span>
                    <span class="tab-label">Recipes</span>
                </NavLink>
                <NavLink class="tab-item" href="meal-plan">
                    <span class="tab-icon">ğŸ“…</span>
                    <span class="tab-label">Meals</span>
                </NavLink>
                <NavLink class="tab-item" href="todos">
                    <span class="tab-icon">âœ…</span>
                    <span class="tab-label">Todos</span>
                </NavLink>
            </Authorized>
            <NotAuthorized>
                <NavLink class="tab-item" href="" Match="NavLinkMatch.All">
                    <span class="tab-icon">ğŸ </span>
                    <span class="tab-label">Home</span>
                </NavLink>
                <NavLink class="tab-item" href="login">
                    <span class="tab-icon">ğŸ‘¤</span>
                    <span class="tab-label">Sign In</span>
                </NavLink>
            </NotAuthorized>
        </AuthorizeView>
    </div>
}
else
{
    <!-- Sidebar for tablet/desktop -->
    <div class="sidebar-content">
        <div class="sidebar-brand">
            <span class="brand-icon">ğŸ </span>
            <span class="brand-text">NineWest</span>
        </div>

        <nav class="sidebar-links">
            <AuthorizeView>
                <Authorized>
                    <NavLink class="sidebar-link" href="" Match="NavLinkMatch.All">
                        <span class="link-icon">ğŸ </span>
                        <span>Home</span>
                    </NavLink>
                    <NavLink class="sidebar-link" href="shopping-list">
                        <span class="link-icon">ğŸ›’</span>
                        <span>Shopping List</span>
                    </NavLink>
                    <NavLink class="sidebar-link" href="recipes">
                        <span class="link-icon">ğŸ“–</span>
                        <span>Recipes</span>
                    </NavLink>
                    <NavLink class="sidebar-link" href="meal-plan">
                        <span class="link-icon">ğŸ“…</span>
                        <span>Meal Plan</span>
                    </NavLink>
                    <NavLink class="sidebar-link" href="todos">
                        <span class="link-icon">âœ…</span>
                        <span>Todos</span>
                    </NavLink>

                    <div class="sidebar-divider"></div>

                    <NavLink class="sidebar-link" href="groups">
                        <span class="link-icon">ğŸ‘¥</span>
                        <span>My Group</span>
                    </NavLink>
                </Authorized>
                <NotAuthorized>
                    <NavLink class="sidebar-link" href="" Match="NavLinkMatch.All">
                        <span class="link-icon">ğŸ </span>
                        <span>Home</span>
                    </NavLink>
                    <NavLink class="sidebar-link" href="login">
                        <span class="link-icon">ğŸ‘¤</span>
                        <span>Sign In</span>
                    </NavLink>
                </NotAuthorized>
            </AuthorizeView>
        </nav>

        <AuthorizeView>
            <Authorized>
                <div class="sidebar-footer">
                    <button class="theme-toggle" @onclick="ToggleTheme" title="Toggle theme">
                        @(_isDark ? "â˜€ï¸" : "ğŸŒ™")
                    </button>
                    <div class="user-info">
                        <span class="user-email">@(context.User.Identity?.Name?.Split('@').FirstOrDefault())</span>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>
    </div>
}

@code {
    [Parameter] public bool BottomBar { get; set; }
    private bool _isDark;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var theme = await JS.InvokeAsync<string>("themeManager.get");
            _isDark = theme == "dark";
            StateHasChanged();
        }
    }

    private async Task ToggleTheme()
    {
        _isDark = !_isDark;
        await JS.InvokeVoidAsync("themeManager.set", _isDark ? "dark" : "light");
    }
}
